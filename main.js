(()=>{"use strict";function e(e,t,n){var o=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),r=o.querySelector(".card__image");r.src=e.link.href,r.alt=e.name,r.addEventListener("click",(function(){n(e.link.href,e.name)})),o.querySelector(".card__title").textContent=e.name,o.querySelector(".card__delete-button").addEventListener("click",(function(){!function(e){e.remove()}(o)}));var c=o.querySelector(".card__like-button");return c.addEventListener("click",(function(){t(c)})),o}function t(e){e.classList.toggle("card__like-button_is-active")}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e){e&&"object"===n(e)?document.querySelectorAll(e.formSelector).forEach((function(t){t.addEventListener("submit",(function(n){n.preventDefault(),function(e,t){var n=e.querySelectorAll(t.inputSelector),o=!0;n.forEach((function(e){r(e,t),e.validity.valid||(o=!1)}));var c=e.querySelector(t.submitButtonSelector);o?c.removeAttribute("disabled"):c.setAttribute("disabled","disabled")}(t,e)})),t.addEventListener("input",(function(n){r(n.target,e),function(e,t){var n=e.querySelectorAll(t.inputSelector),o=!0;n.forEach((function(e){e.validity.valid||(o=!1)}));var r=e.querySelector(t.submitButtonSelector);o?r.removeAttribute("disabled"):r.setAttribute("disabled","disabled")}(t,e)}))})):console.error("Invalid settings object")}function r(e,t){var n=e.nextElementSibling;e.validity.valid?(n.textContent="",n.classList.remove(t.inputErrorClass)):(n.textContent=e.validationMessage,n.classList.add(t.inputErrorClass))}function c(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",i);var t=e.querySelector(".popup__form");t&&function(e){e.addEventListener("submit",(function(t){t.preventDefault();var n,o=e.querySelector(".popup__button"),r=o.textContent;(n=o).textContent="Сохранение...",n.setAttribute("disabled",!0),setTimeout((function(){e.reset(),function(e,t){e.textContent=t,e.removeAttribute("disabled")}(o,r)}),2e3)}))}(t)}function u(e){e.querySelectorAll(".popup__input-error").forEach((function(e){e.textContent="",e.classList.remove("popup__input-error_active")})),e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)}function i(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&u(t)}}function p(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){var o,r,c,u;o=e,r=t,c=n[t],u=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r),(r="symbol"==a(u)?u:String(u))in o?Object.defineProperty(o,r,{value:c,enumerable:!0,configurable:!0,writable:!0}):o[r]=c})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={baseUrl:"https://nomoreparties.co/v1/wff-cohort-10",headers:{authorization:"cd96ad2d-6ac8-4d45-8a99-781f91d662c6","Content-Type":"application/json"}},_=function(e){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:d.headers}).then(p).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function f(e,t){e.querySelector(".card__like-counter").textContent=t.length}function m(e){var t=e.target,n=t.closest(".places__item"),o=n.dataset.cardId;t.classList.contains("card__like-button_liked")?(t.classList.remove("card__like-button_liked"),_(o).then((function(e){f(n,e.likes)})).catch((function(e){console.error("Ошибка при удалении лайка:",e)}))):(t.classList.add("card__like-button_liked"),_(o).then((function(e){f(n,e.likes)})).catch((function(e){console.error("Ошибка при добавлении лайка:",e)})))}var y=[{name:"Архыз",link:new URL("https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg")},{name:"Челябинская область",link:new URL("https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg")},{name:"Иваново",link:new URL("https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg")},{name:"Камчатка",link:new URL("https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg")},{name:"Холмогорский район",link:new URL("https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg")},{name:"Байкал",link:new URL("https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg")}],v=document.querySelector(".popup__input_type_name"),b=document.querySelector(".popup__input_type_description"),S=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),k=S.textContent,E=h.textContent,q=document.querySelector(".popup_type_image"),L=q.querySelector(".popup__image"),g=q.querySelector(".popup__caption"),j=document.querySelector(".places__list"),w=document.querySelector(".popup_type_edit"),C=document.querySelector(".profile__edit-button"),x=w.querySelector(".popup__close"),O=document.querySelector(".popup_type_new-card"),P=document.querySelector(".profile__add-button"),A=O.querySelector(".popup__close"),D=document.forms.edit_profile,U=document.forms.new_place,R=document.querySelector(".popup__input_type_card-name"),B=document.querySelector(".popup__input_type_url"),T=document.querySelector(".profile__image");function I(e){j.prepend(e)}function M(n){I(e(n,t,H))}function z(e){e.preventDefault();var t=v.value,n=b.value;S.textContent=t,h.textContent=n,u(w)}function N(n){n.preventDefault();var o=R.value,r=B.value;I(e({name:o,link:new URL(r)},t,H)),U.reset(),u(O)}function H(e,t){!function(e,t){L.src=e,L.alt=t,g.textContent=t,c(q)}(e,t)}function J(e){var t;e.preventDefault(),t=document.getElementById("avatar__input").value,document.querySelector(".profile__image").src=t,u(document.querySelector(".popup_type_new-avatar"))}document.addEventListener("DOMContentLoaded",(function(){o({formSelector:".popup_type_edit .popup__form",inputSelector:".popup_type_edit .popup__input",submitButtonSelector:".popup_type_edit .popup__button",inputErrorClass:"popup__input-error_active",popup__input_type_error:"popup__input_type_error"}),o({formSelector:".popup_type_new-card .popup__form",inputSelector:".popup_type_new-card .popup__input",submitButtonSelector:".popup_type_new-card .popup__button",inputErrorClass:"popup__input-error_active"}),T.addEventListener("click",(function(){c(document.querySelector(".popup_type_new-avatar"))})),C.addEventListener("click",(function(){c(w),v.value=k,b.value=E})),x.addEventListener("click",(function(){return u(w)})),P.addEventListener("click",(function(){return c(O)})),A.addEventListener("click",(function(){return u(O)})),D.addEventListener("submit",z),U.addEventListener("submit",N),document.querySelectorAll(".popup").forEach((function(e){var t=document.querySelectorAll('[data-modal-target="'.concat(e.id,'"]')),n=e.querySelectorAll(".popup__close");t.forEach((function(t){t.addEventListener("click",(function(){return c(e)}))})),n.forEach((function(t){t.addEventListener("click",(function(){return u(e)}))})),e.addEventListener("click",(function(t){t.target===e&&u(e)}))})),y.forEach(M)})),document.querySelectorAll(".card__like-button").forEach((function(e){e.addEventListener("click",m)})),D.addEventListener("submit",(function(e){e.preventDefault();var t=v.value,n=b.value;S.textContent=t,h.textContent=n;var o,r,c,i=D.querySelector(".popup__button");i.textContent="Сохранение...",(o={name:t,about:n},r=o.name,c=o.about,fetch("".concat(d.baseUrl,"/users/me"),{method:"PATCH",headers:s(s({},d.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:r,about:c})}).then(p).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){u(w)})).catch((function(e){console.error("Ошибка при сохранении профиля:",e)})).finally((function(){i.textContent="Сохранить"}))})),document.addEventListener("DOMContentLoaded",(function(){var e=document.forms.edit_avatar;e&&e.addEventListener("submit",J),o({formSelector:".popup_type_new-avatar .popup__form",inputSelector:".popup_type_new-avatar .popup__input",submitButtonSelector:".popup_type_new-avatar .popup__button",inputErrorClass:"popup__input-error_active"})}))})();