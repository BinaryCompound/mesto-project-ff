(()=>{"use strict";function e(e){e.classList.toggle("card__like-button_is-active")}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){var n=e.nextElementSibling;e.validity.valid?(n.textContent="",n.classList.remove(t.inputErrorClass)):(n.textContent=e.validationMessage,n.classList.add(t.inputErrorClass))}function o(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c);var t=e.querySelector(".popup__form");t&&function(e){e.addEventListener("submit",(function(t){t.preventDefault();var n,o=e.querySelector(".popup__button"),r=o.textContent;(n=o).textContent="Сохранение...",n.setAttribute("disabled",!0),setTimeout((function(){e.reset(),function(e,t){e.textContent=t,e.removeAttribute("disabled")}(o,r)}),2e3)}))}(t)}function r(e){e.querySelectorAll(".popup__input-error").forEach((function(e){e.textContent="",e.classList.remove("popup__input-error_active")})),e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function c(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&r(t)}}function i(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){var o,r,c,i;o=e,r=t,c=n[t],i=function(e,t){if("object"!=u(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=u(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r),(r="symbol"==u(i)?i:String(i))in o?Object.defineProperty(o,r,{value:c,enumerable:!0,configurable:!0,writable:!0}):o[r]=c})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p={baseUrl:"https://nomoreparties.co/v1/wff-cohort-10",headers:{authorization:"cd96ad2d-6ac8-4d45-8a99-781f91d662c6","Content-Type":"application/json"}};function d(){return fetch("".concat(p.baseUrl,"/users/me"),{headers:p.headers}).then(i)}function s(e){return fetch("".concat(p.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:p.headers}).then(i)}function f(e){document.querySelector(".profile__image").src=e}function _(){r(document.querySelector(".popup_type_new-avatar"))}function y(e,t){e.querySelector(".card__like-counter").textContent=t}function m(e){var t=e.target,n=t.closest(".places__item"),o=n.dataset.cardId;t.classList.contains("card__like-button_liked")?(t.classList.remove("card__like-button_liked"),s(o).then((function(e){y(n,e.likesCount)})).catch((function(e){console.error("Ошибка при удалении лайка:",e)}))):(t.classList.add("card__like-button_liked"),s(o).then((function(e){y(n,e.likesCount)})).catch((function(e){console.error("Ошибка при добавлении лайка:",e)})))}window.addEventListener("load",(function(){d().then((function(e){e&&f(e.avatar)})).catch((function(e){console.error("Ошибка при загрузке аватара:",e)}))}));var v=document.querySelector(".popup__input_type_name"),b=document.querySelector(".popup__input_type_description"),S=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),q=S.textContent,E=h.textContent,k=document.querySelector(".popup_type_image"),L=k.querySelector(".popup__image"),g=k.querySelector(".popup__caption"),C=document.querySelector(".places__list"),w=document.querySelector(".popup_type_edit"),O=document.querySelector(".profile__edit-button"),j=(w.querySelector(".popup__close"),document.querySelector(".popup_type_new-card")),x=document.querySelector(".profile__add-button"),P=(j.querySelector(".popup__close"),document.forms.edit_profile),A=document.forms.new_place,D=document.querySelector(".popup__input_type_card-name"),T=document.querySelector(".popup__input_type_url"),U=document.querySelector(".profile__image");function B(e,t,n){e.addEventListener("submit",(function(e){e.preventDefault(),t(e),n()}))}function N(e){e.preventDefault();var t,n,o,r=v.value,c=b.value;S.textContent=r,h.textContent=c,(t={name:r,about:c},n=t.name,o=t.about,fetch("".concat(p.baseUrl,"/users/me"),{method:"PATCH",headers:l(l({},p.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:n,about:o})}).then(i)).catch((function(e){console.error("Ошибка при сохранении профиля:",e)}))}function I(t){var n=function(e,t,n){var o=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),r=o.querySelector(".card__image");r.src=e.link.href,r.alt=e.name,r.addEventListener("click",(function(){n(e.link.href,e.name)})),o.querySelector(".card__title").textContent=e.name,o.querySelector(".card__delete-button").addEventListener("click",(function(){!function(e){e.remove()}(o)}));var c=o.querySelector(".card__like-button");return c.addEventListener("click",(function(){t(c)})),o}(t,e,J);!function(e){C.prepend(e)}(n),n.querySelector(".card__like-button").addEventListener("click",m)}function J(e,t){L.src=e,L.alt=t,g.textContent=t,o(k)}document.querySelector(".profile__image-button"),document.querySelector(".popup_type_new-avatar"),P.addEventListener("submit",N),window.addEventListener("load",(function(){d().then((function(e){e&&function(e){var t=document.querySelector(".profile__title"),n=document.querySelector(".profile__description");t&&n&&(t.textContent=e.name,n.textContent=e.description)}(e)})).catch((function(e){console.error("Ошибка при загрузке профиля:",e)}))})),window.addEventListener("load",(function(){fetch("".concat(p.baseUrl,"/cards"),{headers:p.headers}).then(i).then((function(e){e&&function(e){e.forEach((function(e){I(e)}))}(e)})).catch((function(e){console.error("Ошибка при загрузке карточек:",e)}))})),x.addEventListener("click",(function(){return o(j)})),B(A,(function(){var e,t,n;(e={name:D.value,link:T.value},t=e.name,n=e.link,fetch("".concat(p.baseUrl,"/cards"),{method:"POST",headers:l(l({},p.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:t,link:n})}).then(i)).then((function(e){I(e),A.reset(),r(j)})).catch((function(e){console.error("Ошибка при добавлении карточки:",e)}))}),(function(){return r(j)})),O.addEventListener("click",(function(){o(w),v.value=q,b.value=E})),B(P,N,(function(){return r(w)})),U.addEventListener("click",(function(){o(document.querySelector(".popup_type_new-avatar"))})),B(document.forms.edit_avatar,(function(e){var t;e.preventDefault(),(t=document.getElementById("avatar__input").value,fetch("".concat(p.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l(l({},p.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({avatar:t})}).then(i)).then((function(e){f(e.avatar),_()})).catch((function(e){console.error("Ошибка при обновлении аватара:",e)}))}),_),document.addEventListener("DOMContentLoaded",(function(){var e;(e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input-error_active",popup__input_type_error:"popup__input_type_error"})&&"object"===t(e)?document.querySelectorAll(e.formSelector).forEach((function(t){t.addEventListener("submit",(function(o){o.preventDefault(),function(e,t){var o=e.querySelectorAll(t.inputSelector),r=!0;o.forEach((function(e){n(e,t),e.validity.valid||(r=!1)}));var c=e.querySelector(t.submitButtonSelector);r?c.removeAttribute("disabled"):c.setAttribute("disabled","disabled")}(t,e)})),t.addEventListener("input",(function(o){n(o.target,e),function(e,t){var n=e.querySelectorAll(t.inputSelector),o=!0;n.forEach((function(e){e.validity.valid||(o=!1)}));var r=e.querySelector(t.submitButtonSelector);o?r.removeAttribute("disabled"):r.setAttribute("disabled","disabled")}(t,e)}))})):console.error("Invalid settings object"),document.querySelectorAll(".popup").forEach((function(e){var t=document.querySelectorAll('[data-modal-target="'.concat(e.id,'"]')),n=e.querySelectorAll(".popup__close");t.forEach((function(t){t.addEventListener("click",(function(){return o(e)}))})),n.forEach((function(t){t.addEventListener("click",(function(){return r(e)}))})),e.addEventListener("click",(function(t){t.target===e&&r(e)}))}))}))})();