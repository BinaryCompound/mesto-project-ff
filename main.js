(()=>{"use strict";function e(e){e.classList.toggle("card__like-button_is-active")}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e){e&&"object"===t(e)?document.querySelectorAll(e.formSelector).forEach((function(t){t.addEventListener("submit",(function(n){n.preventDefault(),function(e,t){var n=e.querySelectorAll(t.inputSelector),r=!0;n.forEach((function(e){o(e,t),e.validity.valid||(r=!1)}));var c=e.querySelector(t.submitButtonSelector);r?c.removeAttribute("disabled"):c.setAttribute("disabled","disabled")}(t,e)})),t.addEventListener("input",(function(n){o(n.target,e),function(e,t){var n=e.querySelectorAll(t.inputSelector),o=!0;n.forEach((function(e){e.validity.valid||(o=!1)}));var r=e.querySelector(t.submitButtonSelector);o?r.removeAttribute("disabled"):r.setAttribute("disabled","disabled")}(t,e)}))})):console.error("Invalid settings object")}function o(e,t){var n=e.nextElementSibling;e.validity.valid?(n.textContent="",n.classList.remove(t.inputErrorClass)):(n.textContent=e.validationMessage,n.classList.add(t.inputErrorClass))}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",u);var t=e.querySelector(".popup__form");t&&function(e){e.addEventListener("submit",(function(t){t.preventDefault();var n,o=e.querySelector(".popup__button"),r=o.textContent;(n=o).textContent="Сохранение...",n.setAttribute("disabled",!0),setTimeout((function(){e.reset(),function(e,t){e.textContent=t,e.removeAttribute("disabled")}(o,r)}),2e3)}))}(t)}function c(e){e.querySelectorAll(".popup__input-error").forEach((function(e){e.textContent="",e.classList.remove("popup__input-error_active")})),e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}function u(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&c(t)}}function i(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){var o,r,c,u;o=e,r=t,c=n[t],u=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r),(r="symbol"==a(u)?u:String(u))in o?Object.defineProperty(o,r,{value:c,enumerable:!0,configurable:!0,writable:!0}):o[r]=c})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s={baseUrl:"https://nomoreparties.co/v1/wff-cohort-10",headers:{authorization:"cd96ad2d-6ac8-4d45-8a99-781f91d662c6","Content-Type":"application/json"}},d=function(e){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:s.headers}).then(i).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function _(e,t){e.querySelector(".card__like-counter").textContent=t}function f(e){var t=e.target,n=t.closest(".places__item"),o=n.dataset.cardId;t.classList.contains("card__like-button_liked")?(t.classList.remove("card__like-button_liked"),d(o).then((function(e){_(n,e.likesCount)})).catch((function(e){console.error("Ошибка при удалении лайка:",e)}))):(t.classList.add("card__like-button_liked"),d(o).then((function(e){_(n,e.likesCount)})).catch((function(e){console.error("Ошибка при добавлении лайка:",e)})))}var m=[{name:"Архыз",link:new URL("https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg")},{name:"Челябинская область",link:new URL("https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg")},{name:"Иваново",link:new URL("https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg")},{name:"Камчатка",link:new URL("https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg")},{name:"Холмогорский район",link:new URL("https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg")},{name:"Байкал",link:new URL("https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg")}],y=document.querySelector(".popup__input_type_name"),v=document.querySelector(".popup__input_type_description"),b=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),h=b.textContent,k=S.textContent,E=document.querySelector(".popup_type_image"),L=E.querySelector(".popup__image"),q=E.querySelector(".popup__caption"),g=document.querySelector(".places__list"),j=document.querySelector(".popup_type_edit"),C=document.querySelector(".profile__edit-button"),w=j.querySelector(".popup__close"),x=document.querySelector(".popup_type_new-card"),O=document.querySelector(".profile__add-button"),P=x.querySelector(".popup__close"),A=document.forms.edit_profile,D=document.forms.new_place,U=document.querySelector(".popup__input_type_card-name"),T=document.querySelector(".popup__input_type_url"),B=document.querySelector(".profile__image");function R(e){var t,n,o;e.preventDefault(),(t={name:U.value,link:T.value},n=t.name,o=t.link,fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:l(l({},s.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:n,link:o})}).then(i).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){I(e),D.reset(),c(x)})).catch((function(e){console.error("Ошибка при добавлении карточки:",e)}))}function I(t){var n=function(e,t,n){var o=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),r=o.querySelector(".card__image");r.src=e.link.href,r.alt=e.name,r.addEventListener("click",(function(){n(e.link.href,e.name)})),o.querySelector(".card__title").textContent=e.name,o.querySelector(".card__delete-button").addEventListener("click",(function(){!function(e){e.remove()}(o)}));var c=o.querySelector(".card__like-button");return c.addEventListener("click",(function(){t(c)})),o}(t,e,N);!function(e){g.prepend(e)}(n),n.querySelector(".card__like-button").addEventListener("click",f)}function M(e){e.preventDefault();var t=y.value,n=v.value;b.textContent=t,S.textContent=n,c(j)}function N(e,t){!function(e,t){L.src=e,L.alt=t,q.textContent=t,r(E)}(e,t)}document.addEventListener("DOMContentLoaded",(function(){n({formSelector:".popup_type_edit .popup__form",inputSelector:".popup_type_edit .popup__input",submitButtonSelector:".popup_type_edit .popup__button",inputErrorClass:"popup__input-error_active",popup__input_type_error:"popup__input_type_error"}),n({formSelector:".popup_type_new-card .popup__form",inputSelector:".popup_type_new-card .popup__input",submitButtonSelector:".popup_type_new-card .popup__button",inputErrorClass:"popup__input-error_active"}),O.addEventListener("click",(function(){r(x)})),D.addEventListener("submit",R),B.addEventListener("click",(function(){r(document.querySelector(".popup_type_new-avatar"))})),C.addEventListener("click",(function(){r(j),y.value=h,v.value=k})),w.addEventListener("click",(function(){return c(j)})),O.addEventListener("click",(function(){return r(x)})),P.addEventListener("click",(function(){return c(x)})),A.addEventListener("submit",M),D.addEventListener("submit",R),document.querySelectorAll(".popup").forEach((function(e){var t=document.querySelectorAll('[data-modal-target="'.concat(e.id,'"]')),n=e.querySelectorAll(".popup__close");t.forEach((function(t){t.addEventListener("click",(function(){return r(e)}))})),n.forEach((function(t){t.addEventListener("click",(function(){return c(e)}))})),e.addEventListener("click",(function(t){t.target===e&&c(e)}))})),m.forEach(I)})),document.querySelectorAll(".card__like-button").forEach((function(e){e.addEventListener("click",f)})),B.addEventListener("click",(function(){r(document.querySelector(".popup_type_new-avatar"))}));var z=document.forms.edit_avatar;function J(e){e.preventDefault();var t=document.getElementById("avatar__input").value;updateAvatar(t),c(document.querySelector(".popup_type_new-avatar"))}z&&z.addEventListener("submit",J),A.addEventListener("submit",(function(e){e.preventDefault();var t=y.value,n=v.value;b.textContent=t,S.textContent=n;var o,r,u,a,p=A.querySelector(".popup__button");p.textContent="Сохранение...",(o={name:t,about:n},r=o.name,u=o.about,a=o.avatar,fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:l(l({},s.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:r,about:u,avatar:a})}).then(i).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){c(j)})).catch((function(e){console.error("Ошибка при сохранении профиля:",e)})).finally((function(){p.textContent="Сохранить"}))})),document.addEventListener("DOMContentLoaded",(function(){var e=document.forms.edit_avatar;e&&e.addEventListener("submit",J),n({formSelector:".popup_type_new-avatar .popup__form",inputSelector:".popup_type_new-avatar .popup__input",submitButtonSelector:".popup_type_new-avatar .popup__button",inputErrorClass:"popup__input-error_active"})}))})();