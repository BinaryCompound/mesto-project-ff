(()=>{"use strict";function e(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function o(e){for(var o=1;o<arguments.length;o++){var r=null!=arguments[o]?arguments[o]:{};o%2?n(Object(r),!0).forEach((function(n){var o,c,i,a;o=e,c=n,i=r[n],a=function(e,n){if("object"!=t(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(c),(c="symbol"==t(a)?a:String(a))in o?Object.defineProperty(o,c,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[c]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-10",headers:{authorization:"cd96ad2d-6ac8-4d45-8a99-781f91d662c6","Content-Type":"application/json"}};function c(t){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:r.headers}).then(e)}var i=document.querySelector(".popup__input_type_name"),a=document.querySelector(".popup__input_type_description"),u=document.querySelector(".profile__title"),l=document.querySelector(".profile__description"),s=u.textContent,d=l.textContent,p=document.querySelector(".popup_type_image"),f=p.querySelector(".popup__image"),_=p.querySelector(".popup__caption"),m=document.querySelector(".places__list"),y=document.querySelector(".popup_type_edit"),v=document.querySelector(".profile__edit-button"),b=(y.querySelector(".popup__close"),document.querySelector(".popup_type_new-card")),h=document.querySelector(".profile__add-button"),S=(b.querySelector(".popup__close"),document.forms.edit_profile),q=document.forms.new_place,E=document.querySelector(".popup__input_type_card-name"),k=document.querySelector(".popup__input_type_url"),g=document.querySelector(".profile__image");function L(t,n){fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then(e).then((function(o){o.forEach((function(o){var i=function(t,n,o){var i=document.querySelector("#card-template").content.cloneNode(!0),a=i.querySelector(".card__image"),u=i.querySelector(".card__title"),l=i.querySelector(".card__delete-button"),s=i.querySelector(".card__like-button"),d=i.querySelector(".card__like-counter");return a.src=t.link,a.alt=t.name,u.textContent=t.name,s.dataset.cardId=t._id,d.textContent=t.likes.length,l.addEventListener("click",(function(){var o;t.owner._id===n._id?(l.closest(".card").remove(),(o=s.dataset.cardId,fetch("".concat(r.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:r.headers}).then(e)).then((function(){console.log("Карточка успешно удалена")})).catch((function(e){console.error("Ошибка при удалении карточки:",e)}))):console.error("Нельзя удалять чужие карточки")})),s.addEventListener("click",(function(){var t=s.dataset.cardId;s.classList.contains("card__like-button_is-active")?function(t){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:r.headers}).then(e)}(t).then((function(e){s.classList.remove("card__like-button_is-active"),d.textContent=e.likes.length})).catch((function(e){console.error("Ошибка при дизлайке карточки:",e)})):c(t).then((function(e){s.classList.add("card__like-button_is-active"),d.textContent=e.likes.length})).catch((function(e){console.error("Ошибка при лайке карточки:",e)}))})),a.addEventListener("click",(function(){o(t)})),i}(o,t,n);m.appendChild(i)}))})).catch((function(e){console.error("Ошибка при загрузке карточек:",e)}))}function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function O(e,t){var n=e.nextElementSibling;e.validity.valid?(n.textContent="",n.classList.remove(t.inputErrorClass)):(n.textContent=e.validationMessage,n.classList.add(t.inputErrorClass))}function j(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",x);var t=e.querySelector(".popup__form");t&&function(e){e.addEventListener("submit",(function(t){t.preventDefault();var n,o=e.querySelector(".popup__button"),r=o.textContent;(n=o).textContent="Сохранение...",n.setAttribute("disabled",!0),setTimeout((function(){e.reset(),function(e,t){e.textContent=t,e.removeAttribute("disabled")}(o,r)}),2e3)}))}(t)}function w(e){e.querySelectorAll(".popup__input-error").forEach((function(e){e.textContent="",e.classList.remove("popup__input-error_active")})),e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",x)}function x(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&w(t)}}function P(e){document.querySelector(".profile__image").src=e}function A(){w(document.querySelector(".popup_type_new-avatar"))}function D(e,t){e.querySelector(".card__like-counter").textContent=t}function T(e){var t=e.target,n=t.closest(".places__item"),o=n.dataset.cardId;t.classList.contains("card__like-button_liked")?(t.classList.add("card__like-button_liked"),c(o).then((function(e){D(n,e.likesCount)})).catch((function(e){console.error("Ошибка при удалении лайка:",e)}))):(t.classList.remove("card__like-button_liked"),c(o).then((function(e){D(n,e.likesCount)})).catch((function(e){console.error("Ошибка при добавлении лайка:",e)})))}function U(e,t,n){e.addEventListener("submit",(function(e){e.preventDefault(),t(e),n()}))}function I(e){u.textContent=e.name,l.textContent=e.about}function N(e,t){f.src=e,f.alt=t,_.textContent=t,j(p)}document.querySelector(".profile__image-button"),document.querySelector(".popup_type_new-avatar"),window.addEventListener("load",(function(){fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then(e).then((function(e){e&&P(e.avatar)})).catch((function(e){console.error("Ошибка при загрузке аватара:",e)}))})),function(){var e=localStorage.getItem("profileData");if(e){var t=JSON.parse(e);I(t),i.value=t.name,a.value=t.about}}(),h.addEventListener("click",(function(){return j(b)})),U(q,(function(){var t,n,c;(t={name:E.value,link:k.value},n=t.name,c=t.link,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:o(o({},r.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:n,link:c})}).then(e)).then((function(e){var t;(function(e){m.prepend(e)})(t=createCard(e,handleLike,N)),t.querySelector(".card__like-button").addEventListener("click",T),clearForm(q),w(b)})).catch((function(e){console.error("Ошибка при добавлении карточки:",e)}))}),(function(){return w(b)})),v.addEventListener("click",(function(){j(y),i.value=s,a.value=d})),U(S,(function(t){var n,c,u;t.preventDefault(),(n={name:i.value,about:a.value},c=n.name,u=n.about,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:o(o({},r.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:c,about:u})}).then(e)).then((function(e){!function(e){localStorage.setItem("profileData",JSON.stringify(e))}(e),I(e),clearForm(editMyProfileForm)})).catch((function(e){console.error("Ошибка при сохранении профиля:",e)}))}),(function(){return w(y)})),g.addEventListener("click",(function(){j(document.querySelector(".popup_type_new-avatar"))})),U(document.forms.edit_avatar,(function(t){var n;t.preventDefault(),(n=document.getElementById("avatar__input").value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o(o({},r.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({avatar:n})}).then(e)).then((function(e){P(e.avatar),A()})).catch((function(e){console.error("Ошибка при обновлении аватара:",e)}))}),A),document.addEventListener("DOMContentLoaded",(function(){var e;L(),(e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input-error_active",popup__input_type_error:"popup__input_type_error"})&&"object"===C(e)?document.querySelectorAll(e.formSelector).forEach((function(t){t.addEventListener("submit",(function(n){n.preventDefault(),function(e,t){var n=e.querySelectorAll(t.inputSelector),o=!0;n.forEach((function(e){O(e,t),e.validity.valid||(o=!1)}));var r=e.querySelector(t.submitButtonSelector);o?r.removeAttribute("disabled"):r.setAttribute("disabled","disabled")}(t,e)})),t.addEventListener("input",(function(n){O(n.target,e),function(e,t){var n=e.querySelectorAll(t.inputSelector),o=!0;n.forEach((function(e){e.validity.valid||(o=!1)}));var r=e.querySelector(t.submitButtonSelector);o?r.removeAttribute("disabled"):r.setAttribute("disabled","disabled")}(t,e)}))})):console.error("Invalid settings object"),document.querySelectorAll(".popup").forEach((function(e){var t=document.querySelectorAll('[data-modal-target="'.concat(e.id,'"]')),n=e.querySelectorAll(".popup__close");t.forEach((function(t){t.addEventListener("click",(function(){return j(e)}))})),n.forEach((function(t){t.addEventListener("click",(function(){return w(e)}))})),e.addEventListener("click",(function(t){t.target===e&&w(e)}))}))}))})();